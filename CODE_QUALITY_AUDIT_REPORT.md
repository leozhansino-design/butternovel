# ButterNovel ä»£ç è´¨é‡å®¡è®¡æŠ¥å‘Š

**å®¡è®¡æ—¥æœŸ:** 2025-11-12
**é¡¹ç›®:** ButterNovel - å°è¯´é˜…è¯»å¹³å°
**å®¡è®¡èŒƒå›´:** å…¨æ ˆä»£ç è´¨é‡ã€æ•°æ®å®Œæ•´æ€§ã€æ€§èƒ½å’Œå¯æ‰©å±•æ€§

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### æ€»ä½“è¯„åˆ†: 6.2/10 (éœ€è¦æ”¹è¿›)

| ç±»åˆ« | è¯„åˆ† | çŠ¶æ€ |
|------|------|------|
| æ•°æ®åº“è®¾è®¡ | 7.5/10 | ğŸŸ¡ è‰¯å¥½,æœ‰æ”¹è¿›ç©ºé—´ |
| é”™è¯¯å¤„ç† | 6.0/10 | ğŸŸ¡ éƒ¨åˆ†å®Œå–„,ä¸ä¸€è‡´ |
| æ•°æ®éªŒè¯ | 5.5/10 | ğŸ”´ åŸºæœ¬éªŒè¯å­˜åœ¨,ç¼ºä¹å®Œæ•´æ€§ |
| æ€§èƒ½ä¼˜åŒ– | 4.5/10 | ğŸ”´ å­˜åœ¨å¤šå¤„ N+1 æŸ¥è¯¢ |
| ç±»å‹å®‰å…¨ | 5.0/10 | ğŸ”´ å¤§é‡ä½¿ç”¨ any ç±»å‹ |
| React æœ€ä½³å®è·µ | 6.5/10 | ğŸŸ¡ å­˜åœ¨ Hooks ä¾èµ–é—®é¢˜ |
| ä»£ç å¯ç»´æŠ¤æ€§ | 5.5/10 | ğŸ”´ å¤§é‡é‡å¤ä»£ç  |
| **æ€»åˆ†** | **6.2/10** | ğŸŸ¡ **éœ€è¦æ”¹è¿›** |

### å…³é”®å‘ç°

âœ… **åšå¾—å¥½çš„åœ°æ–¹:**
- Schema è®¾è®¡åˆç†,å¤–é”®å…³ç³»æ­£ç¡®
- å·²é…ç½®çº§è”åˆ é™¤ç­–ç•¥
- éƒ¨åˆ† API ä½¿ç”¨äº†è‰¯å¥½çš„é”™è¯¯å¤„ç†æ¨¡å¼
- ä½¿ç”¨äº†æ•°æ®åº“é‡è¯•æœºåˆ¶

ğŸ”´ **ä¸¥é‡é—®é¢˜ (Critical):**
- ç¼ºå°‘ P2003 å¤–é”®çº¦æŸé”™è¯¯å¤„ç†
- Admin Stats API å­˜åœ¨ 30-90 æ¬¡å¾ªç¯æŸ¥è¯¢
- ç« èŠ‚åˆ—è¡¨æ— åˆ†é¡µ,å¤§å‹å°è¯´ä¼šå´©æºƒ
- 50+ å¤„ä½¿ç”¨ `any` ç±»å‹

ğŸŸ¡ **éœ€è¦æ”¹è¿› (High/Medium):**
- 18+ å¤„é‡å¤çš„è®¤è¯æ£€æŸ¥ä»£ç 
- é”™è¯¯å¤„ç†æ¨¡å¼ä¸ç»Ÿä¸€
- ç¼ºå°‘å…¨æ–‡æœç´¢ç´¢å¼•
- Library API æ‰§è¡Œ 3 æ¬¡ç‹¬ç«‹æŸ¥è¯¢
- 8 å¤„ React Hooks ä¾èµ–é—®é¢˜
- 1500+ è¡Œé‡å¤ä»£ç 

---

## ğŸ—‚ï¸ è¯¦ç»†å®¡è®¡æŠ¥å‘Š

---

## 1ï¸âƒ£ æ•°æ®åº“ Schema å®Œæ•´æ€§åˆ†æ

### âœ… è‰¯å¥½å®è·µ

1. **å¤–é”®å…³ç³»å®šä¹‰å®Œæ•´**
   - æ‰€æœ‰å…³è”éƒ½æ­£ç¡®å®šä¹‰äº†å¤–é”®
   - ä½¿ç”¨äº†é€‚å½“çš„ `@relation` å’Œ `fields`

2. **çº§è”åˆ é™¤é…ç½®åˆç†**
   - æ‰€æœ‰å­è¡¨éƒ½é…ç½®äº† `onDelete: Cascade`
   - é˜²æ­¢å­¤ç«‹æ•°æ®äº§ç”Ÿ

3. **ç´¢å¼•é…ç½®è¾ƒå®Œå–„**
   - ä¸»è¦æŸ¥è¯¢å­—æ®µéƒ½æœ‰ç´¢å¼•
   - å¤åˆç´¢å¼•æ”¯æŒå¸¸è§æŸ¥è¯¢æ¨¡å¼

### âš ï¸ Schema é—®é¢˜å’Œæ”¹è¿›å»ºè®®

#### é—®é¢˜ 1.1: Novel è¡¨ç¼ºå°‘ä½œè€…å¤–é”®å…³ç³»

**ä½ç½®:** `prisma/schema.prisma:97-98`

```prisma
// å½“å‰è®¾è®¡
authorId   String
// author     User    @relation(fields: [authorId], references: [id])  // âŒ æ³¨é‡Šæ‰
authorName String  @default("ButterNovel Official")
```

**é—®é¢˜:**
- `authorId` æ˜¯å­—ç¬¦ä¸²ä½†æ²¡æœ‰å¤–é”®çº¦æŸ
- å¯èƒ½æ’å…¥ä¸å­˜åœ¨çš„ç”¨æˆ· ID
- ä½œè€…ä¿¡æ¯ä¸ä¸€è‡´

**æ¨èä¿®å¤:**
```prisma
model User {
  id     String  @id @default(cuid())
  // ... å…¶ä»–å­—æ®µ
  novels Novel[]  // âœ… æ¢å¤å…³ç³»
}

model Novel {
  authorId   String
  author     User    @relation(fields: [authorId], references: [id], onDelete: Cascade)  // âœ… æ¢å¤å¤–é”®
  authorName String  @default("ButterNovel Official")

  @@index([authorId])  // å·²æœ‰
}
```

**å½±å“:** ä¸­ç­‰ - å¦‚æœè®¡åˆ’æ”¯æŒä½œè€…åŠŸèƒ½,è¿™æ˜¯å¿…é¡»çš„

---

#### é—®é¢˜ 1.2: AdminProfile è¡¨ä¸ Admin è¡¨åˆ†ç¦»

**ä½ç½®:** `prisma/schema.prisma:362-387`

**å½“å‰è®¾è®¡:**
```prisma
model Admin {
  id       String    @id @default(cuid())
  email    String    @unique
  password String
  // ...
}

model AdminProfile {
  id          Int       @id @default(autoincrement())
  email       String    @unique
  displayName String
  avatar      String?
  // ...
}
```

**é—®é¢˜:**
- ä¸¤ä¸ªè¡¨é€šè¿‡ `email` å…³è”,æ²¡æœ‰å¤–é”®
- å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- `AdminProfile` å¯ä»¥ç‹¬ç«‹å­˜åœ¨äº `Admin` ä¹‹å¤–

**æ¨èä¿®å¤æ–¹æ¡ˆ A (å¤–é”®å…³è”):**
```prisma
model Admin {
  id       String        @id @default(cuid())
  email    String        @unique
  password String
  profile  AdminProfile?
  // ...
}

model AdminProfile {
  id          Int    @id @default(autoincrement())
  adminId     String @unique
  admin       Admin  @relation(fields: [adminId], references: [id], onDelete: Cascade)
  displayName String
  avatar      String?
  // ...

  @@index([adminId])
}
```

**æ¨èä¿®å¤æ–¹æ¡ˆ B (åˆå¹¶è¡¨):**
```prisma
model Admin {
  id          String    @id @default(cuid())
  email       String    @unique
  password    String
  displayName String    @default("Admin")
  avatar      String?
  bio         String?
  // ... å…¶ä»–å­—æ®µ
}
```

**æ¨è:** æ–¹æ¡ˆ B æ›´ç®€å•,é™¤éæœ‰ç‰¹æ®Šåˆ†ç¦»éœ€æ±‚

---

#### é—®é¢˜ 1.3: ForumReply.novelId ç¼ºå°‘å¤–é”®çº¦æŸ

**ä½ç½®:** `prisma/schema.prisma:345`

```prisma
model ForumReply {
  // ...
  novelId Int?  // âŒ å¯é€‰çš„å°è¯´ ID,ä½†æ²¡æœ‰å¤–é”®
}
```

**é—®é¢˜:**
- å¯ä»¥æ’å…¥ä¸å­˜åœ¨çš„å°è¯´ ID
- å°è¯´è¢«åˆ é™¤å,å¼•ç”¨ä¸ä¼šè‡ªåŠ¨æ¸…ç†

**æ¨èä¿®å¤:**
```prisma
model ForumReply {
  id      String @id @default(cuid())
  content String @db.Text
  userId  String
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId  String
  post    ForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)

  // âœ… æ·»åŠ å¤–é”®å…³ç³»
  novelId Int?
  novel   Novel? @relation(fields: [novelId], references: [id], onDelete: SetNull)

  helpfulCount Int @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([userId])
  @@index([novelId])  // âœ… æ·»åŠ ç´¢å¼•
}

model Novel {
  // ... ç°æœ‰å­—æ®µ
  forumReplies ForumReply[]  // âœ… æ·»åŠ åå‘å…³ç³»
}
```

---

#### é—®é¢˜ 1.4: ç¼ºå°‘å…¨æ–‡æœç´¢æ”¯æŒ

**å½±å“:** `Novel.title` å’Œ `Novel.authorName` çš„æ¨¡ç³Šæœç´¢æ€§èƒ½å·®

**æ¨èæ·»åŠ :**
```prisma
model Novel {
  // ... ç°æœ‰å­—æ®µ

  // âœ… ä¸ºæ¨¡ç³Šæœç´¢æ·»åŠ  GIN ç´¢å¼• (éœ€è¦åœ¨è¿ç§»ä¸­æ‰‹åŠ¨åˆ›å»º)
  @@index([title(ops: raw("gin_trgm_ops"))], type: Gin, name: "novel_title_gin_idx")
  @@index([authorName(ops: raw("gin_trgm_ops"))], type: Gin, name: "novel_author_gin_idx")
}
```

**è¿ç§» SQL:**
```sql
-- å¯ç”¨ pg_trgm æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_trgm;

-- åˆ›å»º GIN ç´¢å¼•
CREATE INDEX "novel_title_gin_idx" ON "Novel" USING gin (title gin_trgm_ops);
CREATE INDEX "novel_author_gin_idx" ON "Novel" USING gin ("authorName" gin_trgm_ops);
```

---

#### é—®é¢˜ 1.5: Category.order å­—æ®µç¼ºå°‘ç´¢å¼•

**ä½ç½®:** `prisma/schema.prisma:77`

```prisma
model Category {
  id    Int     @id @default(autoincrement())
  name  String  @unique
  slug  String  @unique
  icon  String?
  order Int     @default(0)  // âŒ ç”¨äºæ’åºä½†æ²¡æœ‰ç´¢å¼•

  @@index([slug])
}
```

**æ¨èä¿®å¤:**
```prisma
model Category {
  // ... ç°æœ‰å­—æ®µ

  @@index([slug])
  @@index([order])  // âœ… æ·»åŠ ç´¢å¼•æ”¯æŒæ’åºæŸ¥è¯¢
}
```

---

#### é—®é¢˜ 1.6: ç¼ºå°‘å¤åˆå”¯ä¸€çº¦æŸ

**åœºæ™¯:** é˜²æ­¢é‡å¤æ•°æ®

**å½“å‰å¯èƒ½çš„é—®é¢˜:**
- `NovelLike` è¡¨å·²æœ‰ `@@unique([userId, novelId])` âœ…
- `Library` è¡¨å·²æœ‰ `@@unique([userId, novelId])` âœ…
- `Rating` è¡¨å·²æœ‰ `@@unique([userId, novelId])` âœ…

**çŠ¶æ€:** âœ… å·²æ­£ç¡®é…ç½®

---

### Schema æ”¹è¿›ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“ | ä¿®å¤éš¾åº¦ |
|--------|------|------|----------|
| ğŸ”´ é«˜ | æ·»åŠ å…¨æ–‡æœç´¢ç´¢å¼• | æœç´¢æ€§èƒ½æå‡ 10-100 å€ | ç®€å• |
| ğŸŸ¡ ä¸­ | AdminProfile ä¸ Admin å…³è” | æ•°æ®ä¸€è‡´æ€§ | ä¸­ç­‰ |
| ğŸŸ¡ ä¸­ | ForumReply.novelId å¤–é”® | æ•°æ®å®Œæ•´æ€§ | ç®€å• |
| ğŸŸ¢ ä½ | Novel ä½œè€…å¤–é”®æ¢å¤ | æœªæ¥åŠŸèƒ½æ”¯æŒ | ä¸­ç­‰ |
| ğŸŸ¢ ä½ | Category.order ç´¢å¼• | å¾®å°æ€§èƒ½æå‡ | ç®€å• |

---

## 2ï¸âƒ£ å¤–é”®çº¦æŸå’Œæ•°æ®ä¾èµ–é—®é¢˜

### ğŸ”´ Critical - ç¼ºå°‘ P2003 é”™è¯¯å¤„ç†

**æ–‡ä»¶:** `src/lib/api-error-handler.ts`
**è¡Œå·:** 24-73

**é—®é¢˜:**
é”™è¯¯å¤„ç†å™¨ç¼ºå°‘ Prisma P2003 é”™è¯¯ç (å¤–é”®çº¦æŸå¤±è´¥)çš„å¤„ç†åˆ†æ”¯ã€‚

**å½“å‰ä»£ç :**
```typescript
function handlePrismaError(error: any) {
  if (error.code === 'P2002') {
    return { status: 409, message: 'Record already exists', code: 'UNIQUE_VIOLATION' }
  }
  if (error.code === 'P2025') {
    return { status: 404, message: 'Record not found', code: 'NOT_FOUND' }
  }
  // âŒ ç¼ºå°‘ P2003 å¤„ç†
  return { status: 500, message: 'Database error', code: 'DATABASE_ERROR' }
}
```

**æ¨èä¿®å¤:**
```typescript
function handlePrismaError(error: any) {
  if (error.code === 'P2002') {
    return { status: 409, message: 'Record already exists', code: 'UNIQUE_VIOLATION' }
  }
  if (error.code === 'P2003') {
    // âœ… æ·»åŠ å¤–é”®çº¦æŸé”™è¯¯å¤„ç†
    return {
      status: 404,
      message: 'Referenced record not found',
      code: 'FOREIGN_KEY_CONSTRAINT_FAILED'
    }
  }
  if (error.code === 'P2025') {
    return { status: 404, message: 'Record not found', code: 'NOT_FOUND' }
  }
  return { status: 500, message: 'Database error', code: 'DATABASE_ERROR' }
}
```

**å½±å“æ–‡ä»¶:** æ‰€æœ‰ä½¿ç”¨ `withErrorHandling` çš„ API è·¯ç”±

---

### ğŸ”´ Critical - Library DELETE ç¼ºå°‘å­˜åœ¨æ€§éªŒè¯

**æ–‡ä»¶:** `src/app/api/library/route.ts`
**è¡Œå·:** 151-158

**é—®é¢˜:**
ç›´æ¥æ‰§è¡Œåˆ é™¤,å¦‚æœè®°å½•ä¸å­˜åœ¨ä¼šæŠ›å‡º P2025 é”™è¯¯ã€‚

**å½“å‰ä»£ç :**
```typescript
await prisma.library.delete({
  where: {
    userId_novelId: {
      userId: session.user.id,
      novelId: parseInt(novelId)
    }
  }
})
```

**æ¨èä¿®å¤:**
```typescript
// æ–¹æ¡ˆ A: å…ˆæ£€æŸ¥å†åˆ é™¤
const existing = await prisma.library.findUnique({
  where: {
    userId_novelId: {
      userId: session.user.id,
      novelId: parseInt(novelId)
    }
  }
})

if (!existing) {
  return errorResponse('Novel not in library', 404, 'NOT_IN_LIBRARY')
}

await prisma.library.delete({
  where: {
    userId_novelId: {
      userId: session.user.id,
      novelId: parseInt(novelId)
    }
  }
})

// æ–¹æ¡ˆ B: ä½¿ç”¨ deleteMany (ä¸ä¼šæŠ›å‡ºé”™è¯¯)
const result = await prisma.library.deleteMany({
  where: {
    userId: session.user.id,
    novelId: parseInt(novelId)
  }
})

if (result.count === 0) {
  return errorResponse('Novel not in library', 404, 'NOT_IN_LIBRARY')
}
```

**æ¨è:** æ–¹æ¡ˆ B æ›´é«˜æ•ˆ

---

### ğŸ”´ Critical - Profile UPDATE ç¼ºå°‘ç”¨æˆ·å­˜åœ¨æ€§éªŒè¯

**æ–‡ä»¶:** `src/app/api/profile/route.ts`
**è¡Œå·:** 77-90

**é—®é¢˜:**
ç›´æ¥æ›´æ–°ç”¨æˆ·,ä½† `session.user.id` å¯èƒ½åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨(OAuth ç”¨æˆ·è¢«åˆ é™¤)ã€‚

**æ¨èä¿®å¤:**
```typescript
// å…ˆæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
const existingUser = await prisma.user.findUnique({
  where: { id: session.user.id }
})

if (!existingUser) {
  return errorResponse('User not found', 404, 'USER_NOT_FOUND')
}

// ç„¶åæ›´æ–°
const updatedUser = await prisma.user.update({
  where: { id: session.user.id },
  data: { ... }
})
```

---

### ğŸŸ¡ High - Novel DELETE æœªè®°å½•çº§è”åˆ é™¤æ•°æ®é‡

**æ–‡ä»¶:** `src/app/api/admin/novels/[id]/route.ts`
**è¡Œå·:** 201-206

**é—®é¢˜:**
è™½ç„¶ schema é…ç½®äº†çº§è”åˆ é™¤,ä½†:
1. æœªè®°å½•å°†è¢«åˆ é™¤çš„æ•°æ®é‡(å®¡è®¡éœ€æ±‚)
2. å¤§é‡æ•°æ®åˆ é™¤å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
3. æ²¡æœ‰è½¯åˆ é™¤é€‰é¡¹

**æ¨èæ”¹è¿›:**
```typescript
// 1. æŸ¥è¯¢å…³è”æ•°æ®é‡
const novel = await prisma.novel.findUnique({
  where: { id: novelId },
  include: {
    _count: {
      select: {
        chapters: true,
        library: true,
        readingHistory: true,
        likes: true,
        comments: true,
        views: true,
        ratings: true
      }
    }
  }
})

if (!novel) {
  return NextResponse.json({ error: 'Novel not found' }, { status: 404 })
}

// 2. è®°å½•å®¡è®¡æ—¥å¿—
console.log(`ğŸ—‘ï¸ Deleting novel "${novel.title}" (ID: ${novelId})`)
console.log(`ğŸ“Š Cascading delete will affect:
  - ${novel._count.chapters} chapters
  - ${novel._count.library} library entries
  - ${novel._count.readingHistory} reading histories
  - ${novel._count.likes} likes
  - ${novel._count.comments} comments
  - ${novel._count.views} views
  - ${novel._count.ratings} ratings
`)

// 3. è­¦å‘Šå¤§æ•°æ®é›†
const totalRecords = Object.values(novel._count).reduce((a, b) => a + b, 0)
if (totalRecords > 1000) {
  console.warn('âš ï¸ Large dataset deletion, consider background job or soft delete')
}

// 4. åˆ é™¤å°é¢å›¾ç‰‡
if (novel.coverImagePublicId) {
  await deleteImage(novel.coverImagePublicId).catch(err =>
    console.warn('Failed to delete cover image:', err)
  )
}

// 5. æ‰§è¡Œåˆ é™¤
await prisma.novel.delete({ where: { id: novelId } })
```

---

### ğŸŸ¡ High - Chapter DELETE é‡æ–°æ’åºæ•ˆç‡ä½

**æ–‡ä»¶:** `src/app/api/admin/chapters/[id]/route.ts`
**è¡Œå·:** 137-146

**å½“å‰ä»£ç :**
```typescript
// âŒ å¾ªç¯æ›´æ–°,N æ¬¡æ•°æ®åº“æŸ¥è¯¢
for (const ch of remainingChapters) {
  await prisma.chapter.update({
    where: { id: ch.id },
    data: { chapterNumber: ch.chapterNumber - 1 }
  })
}
```

**æ¨èä¿®å¤:**
```typescript
// âœ… ä½¿ç”¨åŸç”Ÿ SQL æ‰¹é‡æ›´æ–°
await prisma.$executeRaw`
  UPDATE "Chapter"
  SET "chapterNumber" = "chapterNumber" - 1
  WHERE "novelId" = ${chapter.novelId}
  AND "chapterNumber" > ${chapter.chapterNumber}
`
```

**æ€§èƒ½æå‡:** ä» N æ¬¡æŸ¥è¯¢åˆ° 1 æ¬¡æŸ¥è¯¢

---

## 3ï¸âƒ£ é”™è¯¯å¤„ç†å®Œæ•´æ€§é—®é¢˜

### ğŸ”´ ä¸ä¸€è‡´çš„é”™è¯¯å¤„ç†æ¨¡å¼

**é—®é¢˜ç»Ÿè®¡:**

| æ–‡ä»¶ | ä½¿ç”¨ withErrorHandling | æ‰‹åŠ¨ try-catch |
|------|----------------------|----------------|
| `api/library/route.ts` | âœ… | |
| `api/profile/route.ts` | âœ… | |
| `api/reading-progress/route.ts` | | âœ… |
| `api/admin/novels/route.ts` | | âœ… |
| `api/admin/chapters/route.ts` | | âœ… |
| å…¶ä»– admin API | | âœ… (15+ æ–‡ä»¶) |

**æ¨è:** ç»Ÿä¸€ä½¿ç”¨ `withErrorHandling` è£…é¥°å™¨

---

### ğŸŸ¡ ç¼ºå°‘ç‰¹å®šé”™è¯¯ç±»å‹

**æ¨èåˆ›å»º:** `src/lib/api-errors.ts`

```typescript
export class ApiError extends Error {
  constructor(
    message: string,
    public statusCode: number = 500,
    public code?: string
  ) {
    super(message)
  }
}

export class UnauthorizedError extends ApiError {
  constructor(message = 'Unauthorized') {
    super(message, 401, 'UNAUTHORIZED')
  }
}

export class NotFoundError extends ApiError {
  constructor(message = 'Not found') {
    super(message, 404, 'NOT_FOUND')
  }
}

export class ValidationError extends ApiError {
  constructor(message: string, public fields?: Record<string, string>) {
    super(message, 400, 'VALIDATION_ERROR')
  }
}

export class ForbiddenError extends ApiError {
  constructor(message = 'Forbidden') {
    super(message, 403, 'FORBIDDEN')
  }
}
```

---

## 4ï¸âƒ£ æ•°æ®éªŒè¯å®Œæ•´æ€§é—®é¢˜

### ğŸ”´ ç¼ºå°‘è¾“å…¥éªŒè¯åº“

**å½“å‰çŠ¶æ€:** æ‰‹åŠ¨éªŒè¯,é‡å¤ä»£ç å¤š

**æ¨èæ–¹æ¡ˆ:** å¼•å…¥ Zod éªŒè¯åº“

**å®‰è£…:**
```bash
npm install zod
```

**åˆ›å»º:** `src/lib/validators.ts`

```typescript
import { z } from 'zod'

// Novel Schema
export const novelCreateSchema = z.object({
  title: z.string().min(1, 'æ ‡é¢˜ä¸èƒ½ä¸ºç©º').max(120, 'æ ‡é¢˜æœ€å¤š120å­—'),
  coverImage: z.string().min(1, 'å°é¢ä¸èƒ½ä¸ºç©º'),
  categoryId: z.number().int().positive('åˆ†ç±»IDå¿…é¡»æ˜¯æ­£æ•´æ•°'),
  blurb: z.string().min(1, 'ç®€ä»‹ä¸èƒ½ä¸ºç©º').max(3000, 'ç®€ä»‹æœ€å¤š3000å­—'),
  status: z.enum(['ONGOING', 'COMPLETED'], {
    errorMap: () => ({ message: 'çŠ¶æ€å¿…é¡»æ˜¯ONGOINGæˆ–COMPLETED' })
  }),
  isPublished: z.boolean().optional(),
  isDraft: z.boolean().optional(),
})

export const novelUpdateSchema = novelCreateSchema.partial()

// Chapter Schema
export const chapterCreateSchema = z.object({
  novelId: z.number().int().positive(),
  title: z.string().min(1).max(100),
  content: z.string().min(1),
  chapterNumber: z.number().int().positive(),
  isPublished: z.boolean().optional(),
})

export const chapterUpdateSchema = chapterCreateSchema.partial().omit({ novelId: true, chapterNumber: true })

// Rating Schema
export const ratingSchema = z.object({
  score: z.number().int().min(2).max(10).refine(val => val % 2 === 0, {
    message: 'è¯„åˆ†å¿…é¡»æ˜¯ 2, 4, 6, 8, 10 ä¹‹ä¸€'
  }),
  review: z.string().max(1000).optional(),
})

// Auth Schema
export const registerSchema = z.object({
  email: z.string().email('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'),
  password: z.string().min(6, 'å¯†ç è‡³å°‘6ä½').max(50, 'å¯†ç æœ€å¤š50ä½'),
  name: z.string().min(1).max(50).optional(),
})

// å›¾ç‰‡éªŒè¯
export const IMAGE_LIMITS = {
  MAX_SIZE: 2 * 1024 * 1024, // 2MB
  COVER: { width: 300, height: 400 },
  AVATAR: { width: 256, height: 256 },
  ALLOWED_TYPES: ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'],
} as const

export function validateImage(
  file: File,
  type: 'cover' | 'avatar'
): Promise<{ valid: boolean; error?: string }> {
  return new Promise((resolve) => {
    // Type check
    if (!IMAGE_LIMITS.ALLOWED_TYPES.includes(file.type as any)) {
      resolve({ valid: false, error: 'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ã€‚è¯·ä¸Šä¼  JPGã€PNG æˆ– WebP æ ¼å¼' })
      return
    }

    // Size check
    if (file.size > IMAGE_LIMITS.MAX_SIZE) {
      resolve({ valid: false, error: `æ–‡ä»¶è¿‡å¤§ã€‚æœ€å¤§å…è®¸ ${IMAGE_LIMITS.MAX_SIZE / 1024 / 1024}MB` })
      return
    }

    // Dimension check
    const img = new window.Image()
    const url = URL.createObjectURL(file)

    img.onload = () => {
      URL.revokeObjectURL(url)
      const dimensions = type === 'cover' ? IMAGE_LIMITS.COVER : IMAGE_LIMITS.AVATAR

      if (img.width !== dimensions.width || img.height !== dimensions.height) {
        resolve({
          valid: false,
          error: `å›¾ç‰‡å°ºå¯¸å¿…é¡»ä¸º ${dimensions.width}x${dimensions.height}px (å½“å‰: ${img.width}x${img.height}px)`
        })
      } else {
        resolve({ valid: true })
      }
    }

    img.onerror = () => {
      URL.revokeObjectURL(url)
      resolve({ valid: false, error: 'æ— æ³•åŠ è½½å›¾ç‰‡' })
    }

    img.src = url
  })
}

// å­—æ•°éªŒè¯
export const WORD_LIMITS = {
  TITLE_MAX: 120,
  BLURB_MAX: 3000,
  CHAPTER_TITLE_MAX: 100,
  CHAPTER_WORDS_MAX: 5000,
} as const

export function countWords(text: string): number {
  return text.trim().split(/\s+/).filter(w => w).length
}

export function validateWordCount(
  text: string,
  maxWords: number
): { valid: boolean; count: number; error?: string } {
  const count = countWords(text)
  return {
    valid: count <= maxWords,
    count,
    error: count > maxWords
      ? `è¶…å‡ºå­—æ•°é™åˆ¶ ${maxWords} (å½“å‰: ${count})`
      : undefined
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹ (API è·¯ç”±):**
```typescript
import { novelCreateSchema } from '@/lib/validators'

export const POST = withErrorHandling(async (request: Request) => {
  const body = await request.json()

  // âœ… éªŒè¯è¾“å…¥
  const validationResult = novelCreateSchema.safeParse(body)

  if (!validationResult.success) {
    return NextResponse.json({
      error: 'Validation failed',
      details: validationResult.error.flatten()
    }, { status: 400 })
  }

  const data = validationResult.data
  // ... ä½¿ç”¨å·²éªŒè¯çš„æ•°æ®
})
```

---

### ğŸŸ¡ ç¼ºå°‘å‚æ•°ç±»å‹éªŒè¯

**é—®é¢˜ç¤ºä¾‹:** `src/app/api/library/route.ts:98`

```typescript
const { novelId } = await request.json()
// âŒ ç›´æ¥ä½¿ç”¨ parseInt(novelId),æœªéªŒè¯æ˜¯å¦ä¸ºæ•°å­—
```

**æ¨èä¿®å¤:**
```typescript
const { novelId } = await request.json()

// éªŒè¯
if (!novelId || isNaN(parseInt(novelId))) {
  return errorResponse('Invalid novel ID', 400, 'INVALID_NOVEL_ID')
}

const novelIdInt = parseInt(novelId)
```

---

## 5ï¸âƒ£ æ€§èƒ½å’Œå¯æ‰©å±•æ€§é—®é¢˜

### ğŸ”´ Critical - Admin Stats å¾ªç¯æŸ¥è¯¢

**æ–‡ä»¶:** `src/app/api/admin/stats/route.ts`
**è¡Œå·:** 136-176
**ä¸¥é‡æ€§:** æœ€é«˜

**é—®é¢˜:**
åœ¨å¾ªç¯ä¸­æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢,å¦‚æœ `totalIterations = 30`,ä¼šæ‰§è¡Œ **90 æ¬¡æŸ¥è¯¢**ã€‚

**å½“å‰ä»£ç :**
```typescript
for (let i = totalIterations - 1; i >= 0; i--) {
  // âŒ æ¯æ¬¡è¿­ä»£æ‰§è¡Œ 3 æ¬¡æŸ¥è¯¢
  const novelsCount = await prisma.novel.count({ /* ... */ })
  const usersCount = await prisma.user.count({ /* ... */ })
  const viewsCount = await prisma.novelView.count({ /* ... */ })
}
```

**æ¨èä¿®å¤:**
```typescript
// âœ… ä½¿ç”¨å•æ¬¡ GROUP BY æŸ¥è¯¢ä»£æ›¿å¾ªç¯
const [novelsData, usersData, viewsData] = await Promise.all([
  prisma.$queryRaw<Array<{date: Date, count: bigint}>>`
    SELECT DATE_TRUNC('day', "createdAt") as date, COUNT(*) as count
    FROM "Novel"
    WHERE "createdAt" >= ${startDate}
      AND "isPublished" = true
      AND "isBanned" = false
    GROUP BY DATE_TRUNC('day', "createdAt")
    ORDER BY date ASC
  `,
  prisma.$queryRaw<Array<{date: Date, count: bigint}>>`
    SELECT DATE_TRUNC('day', "createdAt") as date, COUNT(*) as count
    FROM "User"
    WHERE "createdAt" >= ${startDate}
      AND "isActive" = true
    GROUP BY DATE_TRUNC('day', "createdAt")
    ORDER BY date ASC
  `,
  prisma.$queryRaw<Array<{date: Date, count: bigint}>>`
    SELECT DATE_TRUNC('day', "viewedAt") as date, COUNT(*) as count
    FROM "NovelView"
    WHERE "viewedAt" >= ${startDate}
    GROUP BY DATE_TRUNC('day', "viewedAt")
    ORDER BY date ASC
  `
])

// æ„å»ºæ•°æ® Map
const novelsMap = new Map(novelsData.map(d => [d.date.toISOString().split('T')[0], Number(d.count)]))
const usersMap = new Map(usersData.map(d => [d.date.toISOString().split('T')[0], Number(d.count)]))
const viewsMap = new Map(viewsData.map(d => [d.date.toISOString().split('T')[0], Number(d.count)]))

// åœ¨å†…å­˜ä¸­æ„å»ºå›¾è¡¨æ•°æ®
for (let i = totalIterations - 1; i >= 0; i--) {
  const dayStart = new Date(startDate)
  dayStart.setDate(dayStart.getDate() + i * intervalDays)
  const dateKey = dayStart.toISOString().split('T')[0]

  chartData.push({
    date: formatDate(dayStart),
    novels: novelsMap.get(dateKey) || 0,
    users: usersMap.get(dateKey) || 0,
    views: viewsMap.get(dateKey) || 0,
  })
}
```

**æ€§èƒ½æå‡:** ä» 90 æ¬¡æŸ¥è¯¢ â†’ 3 æ¬¡æŸ¥è¯¢ = **30 å€æ€§èƒ½æå‡**

---

### ğŸ”´ Critical - ç« èŠ‚åˆ—è¡¨æ— åˆ†é¡µ

**æ–‡ä»¶:** `src/app/novels/[slug]/chapters/[number]/page.tsx`
**è¡Œå·:** 54-68

**é—®é¢˜:**
ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç« èŠ‚,å¦‚æœå°è¯´æœ‰ 1000+ ç« ,ä¼šå¯¼è‡´:
- å†…å­˜æ¶ˆè€—è¿‡å¤§
- é¡µé¢åŠ è½½ç¼“æ…¢
- ç”¨æˆ·ä½“éªŒå·®

**å½“å‰ä»£ç :**
```typescript
// âŒ åŠ è½½æ‰€æœ‰ç« èŠ‚
const allChapters = await prisma.chapter.findMany({
  where: { novel: { slug }, isPublished: true },
  orderBy: { chapterNumber: 'asc' }
})
```

**æ¨èä¿®å¤ (çª—å£åˆ†é¡µ):**
```typescript
const CHAPTER_WINDOW = 20 // å½“å‰ç« èŠ‚å‰åå„æ˜¾ç¤º 10 ç« 

const nearbyChapters = await prisma.chapter.findMany({
  where: {
    novel: { slug },
    isPublished: true,
    chapterNumber: {
      gte: Math.max(1, chapterNumber - 10),
      lte: chapterNumber + 10
    }
  },
  select: {
    id: true,
    chapterNumber: true,
    title: true
  },
  orderBy: { chapterNumber: 'asc' }
})

// åŒæ—¶è·å–æ€»ç« èŠ‚æ•°
const totalChapters = await prisma.chapter.count({
  where: { novel: { slug }, isPublished: true }
})
```

**æ€§èƒ½æå‡:** æ•°æ®é‡å‡å°‘ 90%+

---

### ğŸ”´ Critical - ç¼ºå°‘å…¨æ–‡æœç´¢ç´¢å¼•

**æ–‡ä»¶:** `src/app/api/admin/novels/route.ts`
**è¡Œå·:** 170-174

**é—®é¢˜:**
```typescript
if (search) {
  where.OR = [
    { title: { contains: search, mode: 'insensitive' } },
    { authorName: { contains: search, mode: 'insensitive' } }
  ]
}
```

`contains` + `insensitive` ä¸èƒ½ä½¿ç”¨ç´¢å¼•,å¯¼è‡´å…¨è¡¨æ‰«æã€‚

**æ¨èä¿®å¤:**

**æ­¥éª¤ 1: åˆ›å»ºè¿ç§»å¯ç”¨ pg_trgm**
```sql
-- migrations/xxx_add_fulltext_search.sql
CREATE EXTENSION IF NOT EXISTS pg_trgm;

CREATE INDEX "novel_title_gin_idx" ON "Novel" USING gin (title gin_trgm_ops);
CREATE INDEX "novel_author_gin_idx" ON "Novel" USING gin ("authorName" gin_trgm_ops);
```

**æ­¥éª¤ 2: æ›´æ–°æŸ¥è¯¢ä»£ç **
```typescript
if (search) {
  const novels = await prisma.$queryRaw`
    SELECT *
    FROM "Novel"
    WHERE (
      title ILIKE ${'%' + search + '%'}
      OR "authorName" ILIKE ${'%' + search + '%'}
    )
    ${categoryId ? Prisma.sql`AND "categoryId" = ${parseInt(categoryId)}` : Prisma.empty}
    ORDER BY "createdAt" DESC
    LIMIT ${limit}
    OFFSET ${(page - 1) * limit}
  `
}
```

**æ€§èƒ½æå‡:** 10-100 å€ (å–å†³äºæ•°æ®é‡)

---

### ğŸŸ¡ High - Library API å¤šæ¬¡æŸ¥è¯¢

**æ–‡ä»¶:** `src/app/api/library/route.ts`
**è¡Œå·:** 14-56

**é—®é¢˜:**
æ‰§è¡Œ 3 æ¬¡ç‹¬ç«‹æŸ¥è¯¢,ä¸”ç¬¬ 2ã€3 æ¬¡æŸ¥è¯¢ä¾èµ–ç¬¬ 1 æ¬¡ç»“æœã€‚

**æ¨èä¿®å¤ (åˆå¹¶ä¸ºå•æ¬¡æŸ¥è¯¢):**
```typescript
const libraryData = await prisma.$queryRaw<Array<LibraryItem>>`
  SELECT
    l.id as "libraryId",
    n.id as "novelId",
    n.title,
    n.slug,
    n."coverImage",
    c.name as "categoryName",
    n.status,
    n."totalChapters",
    l."addedAt",
    rh."chapterNumber" as "lastReadChapter",
    rh_ch.title as "lastReadChapterTitle",
    COALESCE(cp_count.count, 0)::int as "readChapters"
  FROM "Library" l
  INNER JOIN "Novel" n ON l."novelId" = n.id
  INNER JOIN "Category" c ON n."categoryId" = c.id
  LEFT JOIN LATERAL (
    SELECT "chapterId"
    FROM "ReadingHistory"
    WHERE "userId" = ${session.user.id} AND "novelId" = n.id
    LIMIT 1
  ) rh_sub ON true
  LEFT JOIN "Chapter" rh_ch ON rh_sub."chapterId" = rh_ch.id
  LEFT JOIN LATERAL (
    SELECT rh_ch."chapterNumber"
    FROM "Chapter" rh_ch
    WHERE rh_ch.id = rh_sub."chapterId"
  ) rh ON true
  LEFT JOIN LATERAL (
    SELECT COUNT(*)::int as count
    FROM "ChapterProgress" cp
    INNER JOIN "Chapter" ch ON cp."chapterId" = ch.id
    WHERE cp."userId" = ${session.user.id} AND ch."novelId" = n.id
  ) cp_count ON true
  WHERE l."userId" = ${session.user.id}
  ORDER BY l."addedAt" DESC
`
```

**æ€§èƒ½æå‡:** 3 æ¬¡æŸ¥è¯¢ â†’ 1 æ¬¡æŸ¥è¯¢ = **3 å€æ€§èƒ½æå‡**

---

### ğŸŸ¡ Medium - RANDOM() æ’åºæ€§èƒ½é—®é¢˜

**æ–‡ä»¶:** `src/app/page.tsx`
**è¡Œå·:** 32, 73

**é—®é¢˜:**
```sql
ORDER BY RANDOM()
```
éœ€è¦æ‰«æå…¨è¡¨å¹¶æ’åº,åœ¨å¤§æ•°æ®é›†ä¸Šæ€§èƒ½å¾ˆå·®ã€‚

**æ¨èä¿®å¤æ–¹æ¡ˆ 1 (é‡‡æ ·):**
```sql
SELECT * FROM "Novel"
TABLESAMPLE SYSTEM (10)  -- éšæœºé‡‡æ · 10% çš„æ•°æ®å—
WHERE "isPublished" = true AND "isBanned" = false
LIMIT 24
```

**æ¨èä¿®å¤æ–¹æ¡ˆ 2 (ç¼“å­˜):**
```typescript
// ä½¿ç”¨ Redis æˆ–å†…å­˜ç¼“å­˜æ¯å°æ—¶é‡æ–°ç”Ÿæˆéšæœºåˆ—è¡¨
import { cache } from '@/lib/cache'

const CACHE_KEY = 'homepage_random_novels'
const CACHE_TTL = 3600 // 1 hour

async function getRandomNovels() {
  const cached = await cache.get(CACHE_KEY)
  if (cached) return cached

  const novels = await prisma.novel.findMany({
    where: { isPublished: true, isBanned: false },
    include: { category: { select: { name: true } } },
    take: 100 // å–æ›´å¤šæ•°æ®
  })

  // æ´—ç‰Œ
  const shuffled = novels.sort(() => Math.random() - 0.5).slice(0, 24)

  await cache.set(CACHE_KEY, shuffled, CACHE_TTL)
  return shuffled
}
```

---

## 6ï¸âƒ£ TypeScript ç±»å‹å®‰å…¨é—®é¢˜

### ğŸ”´ å¤§é‡ä½¿ç”¨ any ç±»å‹

**ç»Ÿè®¡:** 50+ å¤„ä½¿ç”¨ `any` ç±»å‹

**ä¸»è¦é—®é¢˜æ–‡ä»¶:**
1. `src/lib/db-utils.ts` (3 å¤„)
2. `src/lib/api-error-handler.ts` (2 å¤„)
3. `src/lib/db-retry.ts` (5 å¤„)
4. `src/app/api/admin/novels/route.ts` (6 å¤„)
5. `src/app/api/admin/novels/[id]/route.ts` (4 å¤„)
6. `src/components/**/*.tsx` (30+ å¤„)

**æ¨èä¿®å¤ç­–ç•¥:**

#### 1. é”™è¯¯å¤„ç†ç±»å‹
```typescript
// âŒ ä¹‹å‰
function handleError(error: any) { }

// âœ… ä¹‹å
import { Prisma } from '@prisma/client'

function handleError(error: unknown) {
  if (error instanceof Prisma.PrismaClientKnownRequestError) {
    // å¤„ç† Prisma é”™è¯¯
  } else if (error instanceof Error) {
    // å¤„ç†æ™®é€šé”™è¯¯
  } else {
    // å¤„ç†æœªçŸ¥é”™è¯¯
  }
}
```

#### 2. API æ•°æ®å¯¹è±¡ç±»å‹
```typescript
// âŒ ä¹‹å‰
const data: any = {}

// âœ… ä¹‹å
interface NovelUpdateData {
  title?: string
  blurb?: string
  categoryId?: number
  coverImage?: string
  isPublished?: boolean
}

const data: NovelUpdateData = {}
```

#### 3. ç»„ä»¶ Props ç±»å‹
```typescript
// âŒ ä¹‹å‰
onChange={(e) => setStatus(e.target.value as any)}

// âœ… ä¹‹å
type NovelStatus = 'ONGOING' | 'COMPLETED'

onChange={(e) => {
  const value = e.target.value as NovelStatus
  setStatus(value)
}}
```

---

### ğŸ”´ ç¼ºå°‘ API å“åº”ç±»å‹å®šä¹‰

**æ¨èåˆ›å»º:** `src/types/api.ts`

```typescript
import { Prisma } from '@prisma/client'

// é€šç”¨ API å“åº”
export interface ApiResponse<T = any> {
  data?: T
  error?: string
  code?: string
}

export interface PaginatedResponse<T> {
  data: T[]
  pagination: {
    page: number
    limit: number
    total: number
    totalPages: number
  }
}

// Library API
export type NovelWithCategory = Prisma.NovelGetPayload<{
  include: { category: true }
}>

export interface LibraryNovel {
  id: number
  title: string
  slug: string
  coverImage: string
  category: string
  status: 'ONGOING' | 'COMPLETED'
  totalChapters: number
  addedAt: string
  lastReadChapter?: number | null
  lastReadChapterTitle?: string | null
  readChapters?: number
}

export interface LibraryResponse {
  novels: LibraryNovel[]
}

// Novels API
export interface NovelDetail extends NovelWithCategory {
  chapters: Array<{
    id: number
    chapterNumber: number
    title: string
  }>
}

// ä½¿ç”¨ç¤ºä¾‹
import { LibraryResponse } from '@/types/api'

export const GET = async (): Promise<Response> => {
  // ...
  const response: LibraryResponse = { novels }
  return NextResponse.json(response)
}
```

---

### ğŸŸ¡ ä½¿ç”¨ @ts-ignore

**æ–‡ä»¶:** `src/lib/prisma.ts:82`

```typescript
if (process.env.NODE_ENV !== 'production') {
  // @ts-ignore  // âŒ ä¸æ¨è
  globalForPrisma.prisma = prisma
}
```

**æ¨èä¿®å¤:**
```typescript
const globalForPrisma = globalThis as unknown as {
  prisma: typeof prisma | undefined
}

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma  // âœ… ä¸å†éœ€è¦ @ts-ignore
}
```

---

## 7ï¸âƒ£ React Hooks ä¾èµ–å’Œæ— é™å¾ªç¯é—®é¢˜

### ğŸ”´ Critical - Toast ç»„ä»¶ä¾èµ–ä¸ç¨³å®š

**æ–‡ä»¶:** `src/components/shared/Toast.tsx`
**è¡Œå·:** 13-20

**é—®é¢˜:**
```typescript
useEffect(() => {
  if (isVisible) {
    const timer = setTimeout(() => {
      onClose()  // âŒ å¦‚æœ onClose å¼•ç”¨å˜åŒ–,ä¼šé‡æ–°æ‰§è¡Œ
    }, 3000)
    return () => clearTimeout(timer)
  }
}, [isVisible, onClose])
```

**æ¨èä¿®å¤:**
```typescript
useEffect(() => {
  if (isVisible) {
    const timer = setTimeout(() => {
      onClose()
    }, 3000)
    return () => clearTimeout(timer)
  }
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, [isVisible])
```

æˆ–è€…åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ `useCallback`:
```typescript
const handleClose = useCallback(() => {
  setToastVisible(false)
}, [])

<Toast onClose={handleClose} />
```

---

### ğŸ”´ Critical - ChapterReader é”®ç›˜äº‹ä»¶ä¾èµ–é—®é¢˜

**æ–‡ä»¶:** `src/components/reader/ChapterReader.tsx`
**è¡Œå·:** 188-205

**é—®é¢˜:**
```typescript
useEffect(() => {
  const handleKeyPress = (e: KeyboardEvent) => {
    if (e.key === 'ArrowLeft') {
      goToPrevChapter()  // âŒ ä¾èµ–ç¼ºå¤±
    }
    if (e.key === 'ArrowRight') {
      goToNextChapter()  // âŒ ä¾èµ–ç¼ºå¤±
    }
  }
  window.addEventListener('keydown', handleKeyPress)
  return () => window.removeEventListener('keydown', handleKeyPress)
}, [readMode, currentPage, pages.length, hasPrev, hasNext])
// âŒ ç¼ºå°‘ goToPrevChapter, goToNextChapter
```

**æ¨èä¿®å¤:**
```typescript
// 1. ä½¿ç”¨ useCallback åŒ…è£…å¯¼èˆªå‡½æ•°
const goToPrevChapter = useCallback(() => {
  if (hasPrev) {
    router.push(`/novels/${novel.slug}/chapters/${chapter.chapterNumber - 1}`)
  }
}, [hasPrev, router, novel.slug, chapter.chapterNumber])

const goToNextChapter = useCallback(() => {
  if (hasNext) {
    router.push(`/novels/${novel.slug}/chapters/${chapter.chapterNumber + 1}`)
  }
}, [hasNext, router, novel.slug, chapter.chapterNumber])

// 2. æ·»åŠ åˆ°ä¾èµ–æ•°ç»„
useEffect(() => {
  const handleKeyPress = (e: KeyboardEvent) => {
    if (e.key === 'ArrowLeft') {
      goToPrevChapter()
    }
    if (e.key === 'ArrowRight') {
      goToNextChapter()
    }
  }
  window.addEventListener('keydown', handleKeyPress)
  return () => window.removeEventListener('keydown', handleKeyPress)
}, [readMode, currentPage, pages.length, goToPrevChapter, goToNextChapter])
```

---

### ğŸŸ¡ Medium - å¤šå¤„ fetchData å‡½æ•°æœª memo

**å½±å“æ–‡ä»¶:**
- `src/app/admin/page.tsx:29-55`
- `src/components/library/MyLibrary.tsx:36-51`
- `src/components/library/ProfileView.tsx:36-56`
- `src/components/admin/AdminProfileForm.tsx:25-42`
- `src/components/novel/RatingModal.tsx:54-99`

**é€šç”¨ä¿®å¤æ¨¡å¼:**
```typescript
// âŒ ä¹‹å‰
useEffect(() => {
  fetchData()
}, [])

const fetchData = async () => {
  // ...
}

// âœ… ä¹‹å
const fetchData = useCallback(async () => {
  // ...
}, [/* ä¾èµ–é¡¹ */])

useEffect(() => {
  fetchData()
}, [fetchData])
```

---

### âœ… è‰¯å¥½å®è·µç¤ºä¾‹

**æ–‡ä»¶:** `src/components/novel/AddToLibraryButton.tsx`

```typescript
const checkLibraryStatus = useCallback(async () => {
  try {
    const res = await fetch(`/api/library/check?novelId=${novelId}`)
    const data = await res.json()
    setIsInLibrary(data.isInLibrary)
  } catch (error) {
    console.error('Failed to check library status:', error)
  }
}, [novelId])

useEffect(() => {
  if (userId) {
    checkLibraryStatus()
  }
}, [userId, checkLibraryStatus])
```

è¿™ä¸ªç¤ºä¾‹æ­£ç¡®ä½¿ç”¨äº† `useCallback` å’Œå®Œæ•´çš„ä¾èµ–æ•°ç»„ã€‚

---

## 8ï¸âƒ£ ä»£ç é‡å¤å’Œå¯ç»´æŠ¤æ€§é—®é¢˜

### ğŸ”´ è®¤è¯æ£€æŸ¥é‡å¤ 18+ æ¬¡

**æ¨èåˆ›å»º:** `src/lib/admin-middleware.ts`

```typescript
import { getAdminSession } from '@/lib/auth'
import { NextResponse } from 'next/server'

export type AdminSession = {
  id: string
  email: string
  role: string
}

export function withAdminAuth<T extends any[]>(
  handler: (session: AdminSession, ...args: T) => Promise<NextResponse>
) {
  return async (...args: T) => {
    const session = await getAdminSession()

    if (!session) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    return handler(session, ...args)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
export const POST = withAdminAuth(async (session, request: Request) => {
  // session å·²éªŒè¯,ç›´æ¥ä½¿ç”¨
  const body = await request.json()
  // ...
})
```

**å½±å“æ–‡ä»¶:** 18+ ä¸ª admin API è·¯ç”±

**èŠ‚çœä»£ç :** ~100 è¡Œ

---

### ğŸ”´ æ•°æ®åº“æŸ¥è¯¢é€»è¾‘é‡å¤ 12+ æ¬¡

**æ¨èåˆ›å»º:** `src/lib/novel-queries.ts`

```typescript
import { prisma } from '@/lib/prisma'
import { withRetry } from '@/lib/db-utils'

export async function getNovelById(
  novelId: number,
  options?: {
    includeChapters?: boolean
    includeCategory?: boolean
  }
) {
  return withRetry(
    () => prisma.novel.findUnique({
      where: { id: novelId },
      include: {
        chapters: options?.includeChapters ? {
          select: {
            id: true,
            chapterNumber: true,
            title: true,
            wordCount: true,
            isPublished: true,
            createdAt: true
          },
          orderBy: { chapterNumber: 'asc' }
        } : false,
        category: options?.includeCategory ?? true,
      }
    }),
    { operationName: 'Get novel by ID' }
  )
}

export async function getChapterById(chapterId: number) {
  return withRetry(
    () => prisma.chapter.findUnique({
      where: { id: chapterId },
      include: {
        novel: {
          select: {
            id: true,
            title: true,
            slug: true,
            authorId: true
          }
        }
      }
    }),
    { operationName: 'Get chapter by ID' }
  )
}

export async function getOrCreateAdminProfile(email: string) {
  return prisma.adminProfile.upsert({
    where: { email },
    create: {
      email,
      displayName: 'Admin',
      bio: '',
      avatar: null,
    },
    update: {},
  })
}

// éªŒè¯è¾…åŠ©å‡½æ•°
export function validateNovelExists<T>(novel: T | null): asserts novel is T {
  if (!novel) {
    throw new Error('Novel not found')
  }
}

export function validateChapterExists<T>(chapter: T | null): asserts chapter is T {
  if (!chapter) {
    throw new Error('Chapter not found')
  }
}
```

**å½±å“æ–‡ä»¶:** 12+ ä¸ª API è·¯ç”±

**èŠ‚çœä»£ç :** ~200 è¡Œ

---

### ğŸ”´ ç« èŠ‚è¡¨å•ç»„ä»¶ 70% é‡å¤

**æ–‡ä»¶:**
- `src/components/admin/ChapterAddForm.tsx` (168 è¡Œ)
- `src/components/admin/ChapterEditForm.tsx` (306 è¡Œ)

**æ¨èåˆ›å»º:** `src/components/admin/ChapterForm.tsx`

```typescript
import { useState } from 'react'
import { countWords, WORD_LIMITS } from '@/lib/validators'

interface ChapterFormProps {
  mode: 'create' | 'edit'
  novelId: number
  novelTitle: string
  chapterNumber: number
  initialData?: {
    id: number
    title: string
    content: string
    isPublished: boolean
  }
  onSuccess?: () => void
}

export default function ChapterForm({
  mode,
  novelId,
  novelTitle,
  chapterNumber,
  initialData,
  onSuccess
}: ChapterFormProps) {
  const [title, setTitle] = useState(initialData?.title ?? '')
  const [content, setContent] = useState(initialData?.content ?? '')
  const [isPublished, setIsPublished] = useState(initialData?.isPublished ?? true)
  const [loading, setLoading] = useState(false)

  const wordCount = countWords(content)
  const isOverLimit = wordCount > WORD_LIMITS.CHAPTER_WORDS_MAX

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    // éªŒè¯
    if (!title.trim()) {
      alert('è¯·è¾“å…¥ç« èŠ‚æ ‡é¢˜')
      return
    }

    if (!content.trim()) {
      alert('è¯·è¾“å…¥ç« èŠ‚å†…å®¹')
      return
    }

    if (isOverLimit) {
      alert(`ç« èŠ‚å†…å®¹è¶…å‡ºå­—æ•°é™åˆ¶`)
      return
    }

    setLoading(true)

    try {
      const endpoint = mode === 'create'
        ? '/api/admin/chapters'
        : `/api/admin/chapters/${initialData?.id}`

      const method = mode === 'create' ? 'POST' : 'PUT'

      const res = await fetch(endpoint, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          novelId,
          chapterNumber,
          title: title.trim(),
          content: content.trim(),
          isPublished,
        }),
      })

      if (res.ok) {
        alert(mode === 'create' ? 'ç« èŠ‚åˆ›å»ºæˆåŠŸ!' : 'ç« èŠ‚æ›´æ–°æˆåŠŸ!')
        onSuccess?.()
      } else {
        const data = await res.json()
        alert(data.error || 'æ“ä½œå¤±è´¥')
      }
    } catch (error) {
      console.error('Error:', error)
      alert('ç½‘ç»œé”™è¯¯,è¯·é‡è¯•')
    } finally {
      setLoading(false)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {/* ç« èŠ‚ä¿¡æ¯å¡ç‰‡ */}
      <div className="bg-white dark:bg-gray-800 rounded-lg border p-4">
        <h3 className="font-semibold mb-2">ç« èŠ‚ä¿¡æ¯</h3>
        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <span className="text-gray-500">å°è¯´:</span>
            <span className="ml-2 font-medium">{novelTitle}</span>
          </div>
          <div>
            <span className="text-gray-500">ç« èŠ‚å·:</span>
            <span className="ml-2 font-medium">ç¬¬ {chapterNumber} ç« </span>
          </div>
        </div>
      </div>

      {/* æ ‡é¢˜è¾“å…¥ */}
      <div>
        <label className="block text-sm font-medium mb-2">
          ç« èŠ‚æ ‡é¢˜ <span className="text-red-500">*</span>
        </label>
        <input
          type="text"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          placeholder="ä¾‹å¦‚: ç¬¬ä¸€ç«  ç›¸é‡"
          maxLength={WORD_LIMITS.CHAPTER_TITLE_MAX}
          className="w-full px-4 py-2 border rounded-lg"
          required
        />
        <div className="text-sm text-gray-500 mt-1">
          {title.length} / {WORD_LIMITS.CHAPTER_TITLE_MAX} å­—
        </div>
      </div>

      {/* å†…å®¹è¾“å…¥ */}
      <div>
        <label className="block text-sm font-medium mb-2">
          ç« èŠ‚å†…å®¹ <span className="text-red-500">*</span>
        </label>
        <textarea
          value={content}
          onChange={(e) => setContent(e.target.value)}
          placeholder="è¯·è¾“å…¥ç« èŠ‚å†…å®¹..."
          rows={20}
          className="w-full px-4 py-2 border rounded-lg font-mono"
          required
        />
        <div className="flex items-center justify-between mt-2">
          <div className={`text-sm ${isOverLimit ? 'text-red-500 font-semibold' : 'text-gray-500'}`}>
            å­—æ•°: {wordCount} / {WORD_LIMITS.CHAPTER_WORDS_MAX}
            {isOverLimit && ' (è¶…å‡ºé™åˆ¶)'}
          </div>
          {wordCount > 0 && (
            <div className="w-64 bg-gray-200 rounded-full h-2">
              <div
                className={`h-2 rounded-full transition-all ${
                  isOverLimit ? 'bg-red-500' : 'bg-blue-500'
                }`}
                style={{
                  width: `${Math.min(100, (wordCount / WORD_LIMITS.CHAPTER_WORDS_MAX) * 100)}%`
                }}
              />
            </div>
          )}
        </div>
      </div>

      {/* å‘å¸ƒçŠ¶æ€ */}
      <div className="flex items-center gap-2">
        <input
          type="checkbox"
          id="isPublished"
          checked={isPublished}
          onChange={(e) => setIsPublished(e.target.checked)}
          className="rounded"
        />
        <label htmlFor="isPublished" className="text-sm">
          ç«‹å³å‘å¸ƒ (å–æ¶ˆå‹¾é€‰åˆ™ä¿å­˜ä¸ºè‰ç¨¿)
        </label>
      </div>

      {/* æäº¤æŒ‰é’® */}
      <div className="flex gap-4">
        <button
          type="submit"
          disabled={loading || isOverLimit}
          className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {loading ? 'å¤„ç†ä¸­...' : mode === 'create' ? 'åˆ›å»ºç« èŠ‚' : 'ä¿å­˜ä¿®æ”¹'}
        </button>
      </div>
    </form>
  )
}
```

**ä½¿ç”¨ç¤ºä¾‹ (æ·»åŠ ç« èŠ‚):**
```typescript
<ChapterForm
  mode="create"
  novelId={novelId}
  novelTitle={novelTitle}
  chapterNumber={nextChapterNumber}
  onSuccess={() => router.push(`/admin/novels/${novelId}/edit`)}
/>
```

**ä½¿ç”¨ç¤ºä¾‹ (ç¼–è¾‘ç« èŠ‚):**
```typescript
<ChapterForm
  mode="edit"
  novelId={chapter.novelId}
  novelTitle={chapter.novel.title}
  chapterNumber={chapter.chapterNumber}
  initialData={{
    id: chapter.id,
    title: chapter.title,
    content: chapter.content,
    isPublished: chapter.isPublished
  }}
  onSuccess={() => router.refresh()}
/>
```

**èŠ‚çœä»£ç :** ~200 è¡Œ

---

### ğŸŸ¡ å›¾ç‰‡ä¸Šä¼ é€»è¾‘é‡å¤ 5 æ¬¡

**æ¨èæ‰©å±•:** `src/lib/cloudinary.ts`

```typescript
export async function replaceImage(
  oldPublicId: string | null,
  newBase64Image: string,
  type: 'cover' | 'avatar',
  identifier: string
): Promise<{ url: string; publicId: string }> {
  // 1. åˆ é™¤æ—§å›¾ç‰‡
  if (oldPublicId) {
    await deleteImage(oldPublicId).catch(err =>
      console.warn('âš ï¸ Failed to delete old image:', err)
    )
  }

  // 2. ä¸Šä¼ æ–°å›¾ç‰‡
  const uploadFn = type === 'cover' ? uploadNovelCover : uploadUserAvatar
  return uploadFn(newBase64Image, identifier)
}
```

**ä½¿ç”¨ç¤ºä¾‹:**
```typescript
const { url, publicId } = await replaceImage(
  novel.coverImagePublicId,
  newCoverBase64,
  'cover',
  `novel-${novelId}`
)

await prisma.novel.update({
  where: { id: novelId },
  data: {
    coverImage: url,
    coverImagePublicId: publicId
  }
})
```

---

## 9ï¸âƒ£ ä¿®å¤ä¼˜å…ˆçº§æ€»ç»“

### ğŸ”´ ç¬¬ä¸€é˜¶æ®µ: ç«‹å³ä¿®å¤ (Critical - 1-3 å¤©)

**æ•°æ®åº“å’Œæ€§èƒ½:**
1. âœ… æ·»åŠ  P2003 é”™è¯¯å¤„ç† (`api-error-handler.ts`)
2. âœ… ä¿®å¤ Admin Stats å¾ªç¯æŸ¥è¯¢ (30å€æ€§èƒ½æå‡)
3. âœ… æ·»åŠ ç« èŠ‚åˆ—è¡¨åˆ†é¡µ (é˜²æ­¢å´©æºƒ)
4. âœ… æ·»åŠ å…¨æ–‡æœç´¢ç´¢å¼• (10-100å€æ€§èƒ½æå‡)

**é”™è¯¯å¤„ç†:**
5. âœ… ä¿®å¤ Library DELETE å­˜åœ¨æ€§éªŒè¯
6. âœ… ä¿®å¤ Profile UPDATE å­˜åœ¨æ€§éªŒè¯

**é¢„è®¡æ”¶ç›Š:**
- æ€§èƒ½æå‡: 5-10 å€
- é˜²æ­¢ä¸¥é‡ bug
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„

---

### ğŸŸ¡ ç¬¬äºŒé˜¶æ®µ: çŸ­æœŸä¿®å¤ (High - 1-2 å‘¨)

**ä»£ç é‡æ„:**
7. âœ… åˆ›å»ºè®¤è¯ä¸­é—´ä»¶ (`withAdminAuth`) - èŠ‚çœ 100 è¡Œ
8. âœ… ç»Ÿä¸€é”™è¯¯å¤„ç† (æ‰©å±• `withErrorHandling`)
9. âœ… åˆ›å»ºéªŒè¯åº“ (`validators.ts` with Zod)
10. âœ… æå–æ•°æ®åº“æŸ¥è¯¢å‡½æ•° (`novel-queries.ts`)
11. âœ… ç»Ÿä¸€ç« èŠ‚è¡¨å•ç»„ä»¶ - èŠ‚çœ 200 è¡Œ

**æ€§èƒ½ä¼˜åŒ–:**
12. âœ… ä¼˜åŒ– Library API (3æ¬¡â†’1æ¬¡æŸ¥è¯¢)
13. âœ… ä¼˜åŒ– Chapter DELETE é‡æ’åº (Næ¬¡â†’1æ¬¡æŸ¥è¯¢)
14. âœ… ç¼“å­˜éšæœºå°è¯´åˆ—è¡¨

**é¢„è®¡æ”¶ç›Š:**
- å‡å°‘ä»£ç : 500-800 è¡Œ
- æå‡å¯ç»´æŠ¤æ€§: 70%
- æ€§èƒ½æå‡: 2-3 å€

---

### ğŸŸ¢ ç¬¬ä¸‰é˜¶æ®µ: é•¿æœŸä¼˜åŒ– (Medium/Low - æŒç»­æ”¹è¿›)

**ç±»å‹å®‰å…¨:**
15. âœ… ç§»é™¤æ‰€æœ‰ `any` ç±»å‹ (50+ å¤„)
16. âœ… åˆ›å»º API å“åº”ç±»å‹ (`types/api.ts`)
17. âœ… åˆ›å»ºå…±äº«æ¨¡å‹ç±»å‹ (`types/models.ts`)

**React æœ€ä½³å®è·µ:**
18. âœ… ä¿®å¤ 8 å¤„ Hooks ä¾èµ–é—®é¢˜
19. âœ… åˆ›å»ºè‡ªå®šä¹‰ Hooks (`useImageValidation`, `useFetch` ç­‰)

**å…¶ä»–ä¼˜åŒ–:**
20. âœ… Schema æ”¹è¿› (AdminProfile å…³è”, ForumReply å¤–é”®)
21. âœ… æå–æ›´å¤šå¯å¤ç”¨ç»„ä»¶
22. âœ… æ·»åŠ å•å…ƒæµ‹è¯•

**é¢„è®¡æ”¶ç›Š:**
- å‡å°‘ä»£ç : 300-500 è¡Œ
- æå‡ç±»å‹å®‰å…¨: 90%
- é™ä½ç»´æŠ¤æˆæœ¬: 50%

---

## ğŸ¯ æ€»ä½“é¢„æœŸæ”¶ç›Š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| ä»£ç è¡Œæ•° | ~8000 | ~6500 | â¬‡ï¸ 18% |
| æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° (Stats API) | 90 | 3 | â¬‡ï¸ 97% |
| å“åº”æ—¶é—´ (å…³é”® API) | 500ms | 100ms | â¬†ï¸ 5x |
| ä»£ç é‡å¤åº¦ | é«˜ | ä½ | â¬‡ï¸ 70% |
| ç±»å‹å®‰å…¨åº¦ | 50% | 95% | â¬†ï¸ 90% |
| å¯ç»´æŠ¤æ€§è¯„åˆ† | 5.5/10 | 8.5/10 | â¬†ï¸ 55% |
| æµ‹è¯•è¦†ç›–ç‡ | 0% | 60% | â¬†ï¸ 60% |

---

## ğŸ“ å®æ–½å»ºè®®

### å›¢é˜Ÿåä½œ

1. **åˆ›å»º Feature Branch**
   ```bash
   git checkout -b refactor/code-quality-improvements
   ```

2. **æŒ‰é˜¶æ®µæäº¤**
   - æ¯å®Œæˆä¸€ä¸ªä¼˜åŒ–å°± commit
   - ä½¿ç”¨æ¸…æ™°çš„ commit message
   - ä¾‹å¦‚: `fix: add P2003 error handling`

3. **Code Review**
   - æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œ review
   - ç¡®ä¿ä¸å¼•å…¥æ–° bug

4. **æµ‹è¯•éªŒè¯**
   - æ‰‹åŠ¨æµ‹è¯•å…³é”®åŠŸèƒ½
   - æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

---

### ç›‘æ§å’ŒéªŒè¯

1. **æ€§èƒ½ç›‘æ§**
   ```typescript
   // æ·»åŠ æŸ¥è¯¢æ—¥å¿—
   import { PrismaClient } from '@prisma/client'

   const prisma = new PrismaClient({
     log: [
       { level: 'query', emit: 'event' },
       { level: 'error', emit: 'stdout' },
     ],
   })

   prisma.$on('query', (e) => {
     if (e.duration > 100) {
       console.warn(`âš ï¸ Slow query (${e.duration}ms): ${e.query}`)
     }
   })
   ```

2. **é”™è¯¯è¿½è¸ª**
   - é›†æˆ Sentry æˆ–å…¶ä»–é”™è¯¯è¿½è¸ªå·¥å…·
   - ç›‘æ§ç”Ÿäº§ç¯å¢ƒé”™è¯¯ç‡

3. **æ€§èƒ½åŸºå‡†**
   - ä½¿ç”¨ Lighthouse æµ‹è¯•é¡µé¢æ€§èƒ½
   - ä½¿ç”¨ k6 æˆ– Apache Bench è¿›è¡Œå‹åŠ›æµ‹è¯•

---

## ğŸ”— ç›¸å…³èµ„æº

### å­¦ä¹ èµ„æ–™

- [Prisma Best Practices](https://www.prisma.io/docs/guides/performance-and-optimization)
- [React Hooks Rules](https://react.dev/reference/react/hooks#rules-of-hooks)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)
- [Zod Documentation](https://zod.dev/)

### å·¥å…·æ¨è

- **ä»£ç è´¨é‡:** ESLint, Prettier, TypeScript strict mode
- **æµ‹è¯•:** Jest, React Testing Library, Playwright
- **æ€§èƒ½:** Lighthouse, Chrome DevTools, Prisma Studio
- **ç›‘æ§:** Sentry, LogRocket, Vercel Analytics

---

## âœ… æ£€æŸ¥æ¸…å•

### Schema æ”¹è¿›
- [ ] æ·»åŠ å…¨æ–‡æœç´¢ç´¢å¼• (pg_trgm)
- [ ] AdminProfile ä¸ Admin å…³è”
- [ ] ForumReply.novelId æ·»åŠ å¤–é”®
- [ ] Category.order æ·»åŠ ç´¢å¼•
- [ ] è€ƒè™‘æ¢å¤ Novel ä½œè€…å¤–é”®

### é”™è¯¯å¤„ç†
- [ ] æ·»åŠ  P2003 é”™è¯¯å¤„ç†
- [ ] ç»Ÿä¸€æ‰€æœ‰ API ä½¿ç”¨ withErrorHandling
- [ ] åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯ç±» (api-errors.ts)
- [ ] æ·»åŠ  Library/Profile å­˜åœ¨æ€§éªŒè¯

### æ€§èƒ½ä¼˜åŒ–
- [ ] ä¿®å¤ Admin Stats å¾ªç¯æŸ¥è¯¢
- [ ] æ·»åŠ ç« èŠ‚åˆ—è¡¨åˆ†é¡µ
- [ ] ä¼˜åŒ– Library API (1æ¬¡æŸ¥è¯¢)
- [ ] ä¼˜åŒ– Chapter DELETE é‡æ’åº
- [ ] ç¼“å­˜é¦–é¡µéšæœºå°è¯´

### ä»£ç é‡æ„
- [ ] åˆ›å»ºè®¤è¯ä¸­é—´ä»¶ (withAdminAuth)
- [ ] åˆ›å»ºéªŒè¯åº“ (validators.ts)
- [ ] æå–æ•°æ®åº“æŸ¥è¯¢å‡½æ•° (novel-queries.ts)
- [ ] ç»Ÿä¸€ç« èŠ‚è¡¨å•ç»„ä»¶
- [ ] æå–å›¾ç‰‡ä¸Šä¼ é€»è¾‘

### ç±»å‹å®‰å…¨
- [ ] ç§»é™¤æ‰€æœ‰ any ç±»å‹
- [ ] åˆ›å»º API å“åº”ç±»å‹ (types/api.ts)
- [ ] åˆ›å»ºå…±äº«æ¨¡å‹ç±»å‹ (types/models.ts)
- [ ] ç§»é™¤ @ts-ignore

### React æœ€ä½³å®è·µ
- [ ] ä¿®å¤ Toast ç»„ä»¶ä¾èµ–
- [ ] ä¿®å¤ ChapterReader é”®ç›˜äº‹ä»¶
- [ ] ä¿®å¤æ‰€æœ‰ fetchData useCallback
- [ ] åˆ›å»ºè‡ªå®šä¹‰ Hooks

---

## ğŸ‰ ç»“è®º

è¿™ä»½å®¡è®¡æŠ¥å‘Šè¯†åˆ«äº† **100+ ä¸ªä»£ç è´¨é‡é—®é¢˜**,å¹¶æä¾›äº†è¯¦ç»†çš„ä¿®å¤æ–¹æ¡ˆã€‚é€šè¿‡åˆ†é˜¶æ®µå®æ–½è¿™äº›æ”¹è¿›,å¯ä»¥:

1. **æ˜¾è‘—æå‡æ€§èƒ½** (5-10 å€)
2. **å‡å°‘ä»£ç é‡** (18%)
3. **æé«˜å¯ç»´æŠ¤æ€§** (55%)
4. **å¢å¼ºç±»å‹å®‰å…¨** (90%)
5. **æ”¹å–„ç”¨æˆ·ä½“éªŒ**

å»ºè®®ç«‹å³å¼€å§‹ç¬¬ä¸€é˜¶æ®µçš„ Critical ä¿®å¤,ç„¶åé€æ­¥æ¨è¿›åˆ°åç»­é˜¶æ®µã€‚

**é¢„è®¡æ€»æŠ•å…¥æ—¶é—´:** 2-3 å‘¨å…¨èŒå¼€å‘

**é¢„è®¡é•¿æœŸæ”¶ç›Š:** å‡å°‘ 50% ç»´æŠ¤æˆæœ¬,æå‡å›¢é˜Ÿå¼€å‘æ•ˆç‡

---

**æŠ¥å‘Šç”Ÿæˆ:** Claude Code Quality Auditor
**æ—¥æœŸ:** 2025-11-12
**ç‰ˆæœ¬:** 1.0
