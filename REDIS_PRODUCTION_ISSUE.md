# ç”Ÿäº§ç¯å¢ƒ Redis Commands æ¶ˆè€—å¼‚å¸¸è¯Šæ–­

## ğŸš¨ é—®é¢˜æè¿°

**ç¯å¢ƒ**ï¼šProduction (butternovel.com)
**ç°è±¡**ï¼šåˆ·æ–°é¦–é¡µå‡ æ¬¡ï¼ŒUpstash Commands å¢åŠ äº† 200+
**é¢„æœŸ**ï¼šåº”è¯¥åªå¢åŠ  34-50 commands
**å®é™…**ï¼šå¢åŠ äº† 4-5 å€

## ğŸ” å¯èƒ½çš„åŸå› åˆ†æ

### 1. ISR/Edge Cache æœªç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼šæ¯æ¬¡åˆ·æ–°éƒ½è§¦å‘æœåŠ¡å™¨æ¸²æŸ“
**åŸå› **ï¼š
- Next.js ISR (`revalidate = 3600`) å¯èƒ½æœªç”Ÿæ•ˆ
- Vercel Edge Cache å¯èƒ½æœªå¯ç”¨
- åŠ¨æ€å†…å®¹å¯¼è‡´æ— æ³•é™æ€ç¼“å­˜

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥å“åº”å¤´
curl -I https://butternovel.com/

# æŸ¥æ‰¾ä»¥ä¸‹ headerï¼š
# x-vercel-cache: HIT  â†’ ç¼“å­˜å‘½ä¸­ï¼ˆå¥½ï¼‰
# x-vercel-cache: MISS â†’ ç¼“å­˜æœªå‘½ä¸­ï¼ˆé—®é¢˜ï¼‰
# x-vercel-cache: BYPASS â†’ è·³è¿‡ç¼“å­˜ï¼ˆé—®é¢˜ï¼‰
```

**é¢„æœŸè¡Œä¸º**ï¼š
- ç¬¬ä¸€æ¬¡è®¿é—®ï¼š`x-vercel-cache: MISS` + 17 reads + 17 writes = 34 commands
- åç»­è®¿é—®ï¼ˆ1å°æ—¶å†…ï¼‰ï¼š`x-vercel-cache: HIT` + 0 Redis commands

**å¦‚æœæ¯æ¬¡éƒ½æ˜¯ MISS**ï¼šè¯´æ˜ ISR æœªç”Ÿæ•ˆï¼Œéœ€è¦æ£€æŸ¥ï¼š
1. é¡µé¢æ˜¯å¦æœ‰åŠ¨æ€å†…å®¹ï¼ˆcookies/headersï¼‰
2. `revalidate` é…ç½®æ˜¯å¦æ­£ç¡®
3. Vercel é…ç½®æ˜¯å¦æ­£ç¡®

---

### 2. ç¼“å­˜è¯»å–è¿‡å¤š

**ç—‡çŠ¶**ï¼šå³ä½¿ç¼“å­˜æœªå‘½ä¸­ï¼Œ200 commands ä¹Ÿå¤ªå¤š
**åŸå› **ï¼šå¯èƒ½æœ‰é‡å¤çš„ç¼“å­˜è¯»å–

**å½“å‰é¦–é¡µæ¶æ„**ï¼š
```
é¦–é¡µæ¸²æŸ“ = 17 readsï¼ˆç¼“å­˜å‘½ä¸­ï¼‰æˆ– 17 reads + 17 writesï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰
```

**200 commands æ„å‘³ç€**ï¼š
- çº¦ 11-12 æ¬¡å®Œæ•´çš„é¦–é¡µæ¸²æŸ“
- æˆ–è€…æœ‰å…¶ä»–é¡µé¢/API ä¹Ÿåœ¨æ¶ˆè€— commands

**éœ€è¦æ£€æŸ¥**ï¼š
1. æ˜¯å¦æœ‰å…¶ä»–é¡µé¢ä¹Ÿåœ¨è®¿é—®ï¼ˆå¦‚å°è¯´è¯¦æƒ…é¡µã€åˆ†ç±»é¡µï¼‰
2. æ˜¯å¦æœ‰åå°ä»»åŠ¡åœ¨è¯»å– Redis
3. æ˜¯å¦æœ‰é‡å¤çš„ç¼“å­˜é”®æŸ¥è¯¢

---

### 3. Upstash è‡ªåŠ¨ååºåˆ—åŒ–é—®é¢˜

**æœ€è¿‘çš„ä¿®å¤**ï¼šæˆ‘ä»¬ä¿®å¤äº† Upstash GET è‡ªåŠ¨ååºåˆ—åŒ–çš„é—®é¢˜
**å½“å‰ä»£ç **ï¼š
```typescript
const value = await client.get(key);
if (typeof value !== 'string') {
  return JSON.stringify(value); // é‡æ–°åºåˆ—åŒ–
}
```

**æ½œåœ¨é—®é¢˜**ï¼š
- æ¯æ¬¡ GET éƒ½è¿”å›å¯¹è±¡ â†’ æ¯æ¬¡éƒ½éœ€è¦é‡æ–°åºåˆ—åŒ–
- è¿™å¯èƒ½å¯¼è‡´é¢å¤–çš„ SET æ“ä½œï¼Ÿ

**éªŒè¯**ï¼šæ£€æŸ¥ Vercel æ—¥å¿—ï¼Œçœ‹æ˜¯å¦æœ‰å¤§é‡ï¼š
```
ğŸ” Redis GET: xxx (ç±»å‹: object)
   â†’ æ˜¯å¯¹è±¡ï¼Œé‡æ–°åºåˆ—åŒ–ä¸º JSON
```

---

### 4. ç¼“å­˜å¤±æ•ˆè¿‡äºé¢‘ç¹

**å¯èƒ½åŸå› **ï¼š
- Admin æ“ä½œé¢‘ç¹æ¸…é™¤ç¼“å­˜
- æœ‰åå°ä»»åŠ¡å®šæœŸæ¸…é™¤ç¼“å­˜
- æŸä¸ª API ç«¯ç‚¹é”™è¯¯åœ°è§¦å‘äº†ç¼“å­˜å¤±æ•ˆ

**éœ€è¦æ£€æŸ¥**ï¼š
- Vercel æ—¥å¿—ä¸­æ˜¯å¦æœ‰å¤§é‡ "âœ“ ç¼“å­˜å·²æ¸…é™¤" æ¶ˆæ¯
- æ˜¯å¦æœ‰å®šæ—¶ä»»åŠ¡åœ¨æ¸…é™¤ç¼“å­˜

---

### 5. å¹¶å‘è¯·æ±‚å¯¼è‡´é‡å¤ç¼“å­˜å†™å…¥

**åœºæ™¯**ï¼šå¤šä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶è§¦å‘ç¼“å­˜æœªå‘½ä¸­
```
ç”¨æˆ· A è®¿é—®é¦–é¡µ â†’ ç¼“å­˜æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ Redis (17 writes)
ç”¨æˆ· B åŒæ—¶è®¿é—® â†’ ç¼“å­˜æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ Redis (17 writes)
ç”¨æˆ· C åŒæ—¶è®¿é—® â†’ ç¼“å­˜æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ Redis (17 writes)
---
æ€»è®¡ï¼š51 writesï¼ˆè€Œä¸æ˜¯é¢„æœŸçš„ 17ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**ï¼šéœ€è¦ä½¿ç”¨ç¼“å­˜é”æˆ–å»é‡æœºåˆ¶

---

## ğŸ› ï¸ è¯Šæ–­æ­¥éª¤

### Step 1ï¼šæ£€æŸ¥ Vercel Cache Headers

```bash
# å¤šæ¬¡è®¿é—®é¦–é¡µï¼Œæ£€æŸ¥ç¼“å­˜è¡Œä¸º
for i in {1..5}; do
  echo "Request $i:"
  curl -I https://butternovel.com/ 2>/dev/null | grep -E "x-vercel-cache|cache-control"
  echo ""
  sleep 2
done
```

**é¢„æœŸç»“æœ**ï¼š
```
Request 1:
x-vercel-cache: MISS    â† ç¬¬ä¸€æ¬¡ï¼Œç¼“å­˜æœªå‘½ä¸­
cache-control: public, s-maxage=3600

Request 2-5:
x-vercel-cache: HIT     â† åç»­ï¼Œç¼“å­˜å‘½ä¸­
cache-control: public, s-maxage=3600
```

**å¦‚æœæ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ MISS**ï¼šISR æœªç”Ÿæ•ˆï¼

---

### Step 2ï¼šæ£€æŸ¥ Upstash Dashboard Metrics

è®¿é—® Upstash Dashboard â†’ Metricsï¼š

**è§‚å¯ŸæŒ‡æ ‡**ï¼š
1. **Total Commands**ï¼šæ€»å‘½ä»¤æ•°
2. **Reads vs Writes**ï¼šè¯»å†™æ¯”ä¾‹
3. **Peak Usage**ï¼šå³°å€¼ä½¿ç”¨æ—¶é—´

**æ­£å¸¸æƒ…å†µ**ï¼ˆå‡è®¾é¦–é¡µåˆ·æ–° 5 æ¬¡ï¼‰ï¼š
```
ç¬¬ 1 æ¬¡åˆ·æ–°ï¼š17 reads + 17 writes = 34 commands
ç¬¬ 2-5 æ¬¡åˆ·æ–°ï¼š0 commandsï¼ˆEdge Cache å‘½ä¸­ï¼‰
---
æ€»è®¡ï¼š34 commands
```

**å¼‚å¸¸æƒ…å†µ 1**ï¼ˆISR æœªç”Ÿæ•ˆï¼‰ï¼š
```
æ¯æ¬¡åˆ·æ–°ï¼š17 reads = 17 commands
5 æ¬¡åˆ·æ–°ï¼š85 commands
```

**å¼‚å¸¸æƒ…å†µ 2**ï¼ˆç¼“å­˜æœªå‘½ä¸­ + é‡å¤å†™å…¥ï¼‰ï¼š
```
æ¯æ¬¡åˆ·æ–°ï¼š17 reads + 17 writes = 34 commands
5 æ¬¡åˆ·æ–°ï¼š170 commands
```

**å¼‚å¸¸æƒ…å†µ 3**ï¼ˆå¹¶å‘é‡å¤å†™å…¥ï¼‰ï¼š
```
5 æ¬¡å¹¶å‘è¯·æ±‚åŒæ—¶è§¦å‘ç¼“å­˜æœªå‘½ä¸­
5 Ã— (17 reads + 17 writes) = 170 commands
```

---

### Step 3ï¼šæ£€æŸ¥ Vercel Runtime Logs

è®¿é—® Vercel â†’ butternovel â†’ Logs â†’ Runtime Logs

**æŸ¥æ‰¾å…³é”®ä¿¡æ¯**ï¼š

**1. ç¼“å­˜å‘½ä¸­æƒ…å†µ**ï¼š
```bash
# æœç´¢ï¼šâœ“ ç¼“å­˜å‘½ä¸­
# åº”è¯¥çœ‹åˆ°å¤§é‡ç¼“å­˜å‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰ â†’ é—®é¢˜ï¼
```

**2. ç¼“å­˜å†™å…¥æ¬¡æ•°**ï¼š
```bash
# æœç´¢ï¼šâœ“ æ•°æ®å·²ç¼“å­˜
# è®¡ç®—å‡ºç°æ¬¡æ•°ï¼Œåº”è¯¥å¾ˆå°‘ï¼ˆåªåœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼‰
```

**3. Redis GET ç±»å‹**ï¼š
```bash
# æœç´¢ï¼šğŸ” Redis GET
# æ£€æŸ¥æ˜¯å¦è¿”å› object ç±»å‹ï¼ˆUpstash è‡ªåŠ¨ååºåˆ—åŒ–ï¼‰
```

**4. ç¼“å­˜å¤±æ•ˆæ“ä½œ**ï¼š
```bash
# æœç´¢ï¼šâœ“ ç¼“å­˜å·²æ¸…é™¤
# å¦‚æœé¢‘ç¹å‡ºç° â†’ å¯èƒ½æœ‰é—®é¢˜
```

---

### Step 4ï¼šæ£€æŸ¥é¡µé¢åŠ¨æ€å†…å®¹

**é—®é¢˜**ï¼šå¦‚æœé¡µé¢ä½¿ç”¨äº† cookies/headersï¼Œä¼šå¼ºåˆ¶åŠ¨æ€æ¸²æŸ“

**æ£€æŸ¥ä»£ç **ï¼š
```bash
# æœç´¢æ˜¯å¦ä½¿ç”¨äº†åŠ¨æ€ API
grep -r "cookies()\|headers()" src/app/page.tsx
grep -r "useSearchParams\|searchParams" src/app/page.tsx
```

**å¦‚æœæ‰¾åˆ°**ï¼šéœ€è¦ç§»é™¤æˆ–æ”¹ä¸ºå®¢æˆ·ç«¯æ¸²æŸ“

---

### Step 5ï¼šåˆ†æå…·ä½“çš„ Commands æ¶ˆè€—

**æ–¹æ³•**ï¼šåœ¨ Upstash Dashboard æŸ¥çœ‹å…·ä½“çš„å‘½ä»¤ç±»å‹

**æ­£å¸¸æƒ…å†µ**ï¼š
```
GET home:featured: 1
GET home:all-categories: 1
GET home:category:fantasy: 1
GET home:category:romance: 1
... (15 ä¸ªåˆ†ç±»)
---
æ€»è®¡ï¼š17 GET commands
```

**å¼‚å¸¸æƒ…å†µ**ï¼š
- å¦‚æœæœ‰é‡å¤çš„ GET åŒä¸€ä¸ª key
- å¦‚æœæœ‰å¤§é‡ SET æ“ä½œ
- å¦‚æœæœ‰å…¶ä»–æ„å¤–çš„ key

---

## ğŸ¯ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šå¼ºåˆ¶å¯ç”¨ ISRï¼ˆå¦‚æœ ISR æœªç”Ÿæ•ˆï¼‰

åœ¨ `src/app/page.tsx` ä¸­ç¡®ä¿ï¼š

```typescript
// ç¡®ä¿è¿™è¡Œå­˜åœ¨
export const revalidate = 3600

// ç¡®ä¿æ²¡æœ‰ä½¿ç”¨åŠ¨æ€ API
// âŒ ä¸è¦ä½¿ç”¨ï¼š
// - cookies()
// - headers()
// - useSearchParams (æœåŠ¡å™¨ç«¯)
// - searchParams (æœåŠ¡å™¨ç«¯)

// âœ… å¯ä»¥ä½¿ç”¨ï¼š
// - æ•°æ®åº“æŸ¥è¯¢
// - Redis ç¼“å­˜
// - é™æ€æ•°æ®
```

---

### æ–¹æ¡ˆ 2ï¼šå®æ–½ Redis Commands ä¼˜åŒ–ï¼ˆç«‹å³ï¼‰

**ä¼˜åŒ– 1ï¼šä½¿ç”¨å•ä¸ªç¼“å­˜é”®**ï¼ˆæ¨èï¼‰

å‚è€ƒ `REDIS_OPTIMIZATION.md` ä¸­çš„æ–¹æ¡ˆï¼Œå°† 17 ä¸ªç¼“å­˜é”®åˆå¹¶ä¸º 1 ä¸ªï¼š

```typescript
// ä½¿ç”¨ cache-optimized.ts ä¸­çš„ getHomePageData()
// ä» 17 reads â†’ 1 read
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘ 94% commands
- å³ä½¿ ISR æœªç”Ÿæ•ˆï¼Œä¹Ÿèƒ½å¤§å¹…é™ä½æ¶ˆè€—

---

**ä¼˜åŒ– 2ï¼šæ·»åŠ ç¼“å­˜é”**ï¼ˆé˜²æ­¢å¹¶å‘é‡å¤å†™å…¥ï¼‰

```typescript
// åœ¨ cache.ts ä¸­æ·»åŠ ç®€å•çš„é”æœºåˆ¶
const locks = new Map<string, Promise<any>>();

export async function getOrSet<T>(
  key: string,
  fetchFunction: () => Promise<T>,
  ttl?: number
): Promise<T> {
  // 1. å°è¯•ä»ç¼“å­˜è·å–
  const cached = await safeRedisGet(key);
  if (cached) {
    return JSON.parse(cached) as T;
  }

  // 2. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¯·æ±‚æ­£åœ¨ç”Ÿæˆè¿™ä¸ªç¼“å­˜
  if (locks.has(key)) {
    console.log(`â³ ç­‰å¾…å…¶ä»–è¯·æ±‚ç”Ÿæˆç¼“å­˜: ${key}`);
    return await locks.get(key);
  }

  // 3. åˆ›å»ºé”å¹¶æ‰§è¡ŒæŸ¥è¯¢
  const promise = (async () => {
    try {
      console.log(`âœ— ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“: ${key}`);
      const data = await fetchFunction();

      if (isRedisConnected()) {
        const serialized = safeStringify(data);
        await safeRedisSet(key, serialized, ttl);
        console.log(`âœ“ æ•°æ®å·²ç¼“å­˜: ${key}`);
      }

      return data;
    } finally {
      locks.delete(key);
    }
  })();

  locks.set(key, promise);
  return promise;
}
```

**ä¼˜åŠ¿**ï¼š
- é˜²æ­¢å¹¶å‘è¯·æ±‚é‡å¤å†™å…¥
- å‡å°‘ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢

---

**ä¼˜åŒ– 3ï¼šå‡å°‘è°ƒè¯•æ—¥å¿—**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

åœ¨ `redis.ts` å’Œ `cache.ts` ä¸­æ·»åŠ ç¯å¢ƒå˜é‡æ§åˆ¶ï¼š

```typescript
const isDev = process.env.NODE_ENV === 'development';
const ENABLE_DEBUG = process.env.REDIS_DEBUG === 'true' || isDev;

// åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºè¯¦ç»†æ—¥å¿—
if (ENABLE_DEBUG) {
  console.log(`ğŸ” Redis GET: ${key}`);
}
```

---

### æ–¹æ¡ˆ 3ï¼šç›‘æ§å’Œå‘Šè­¦ï¼ˆé•¿æœŸï¼‰

1. **æ·»åŠ  Upstash Webhook**ï¼šcommands è¶…è¿‡é˜ˆå€¼æ—¶å‘Šè­¦
2. **æ·»åŠ è‡ªå®šä¹‰ç›‘æ§**ï¼šè®°å½•æ¯æ¬¡è¯·æ±‚çš„ commands æ¶ˆè€—
3. **å®šæœŸæ£€æŸ¥**ï¼šæ¯å‘¨æŸ¥çœ‹ Upstash Metrics

---

## ğŸ“‹ è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰

1. âœ… æ£€æŸ¥ Vercel Cache Headersï¼ˆ5 åˆ†é’Ÿï¼‰
2. âœ… æ£€æŸ¥ Upstash Dashboard Metricsï¼ˆ5 åˆ†é’Ÿï¼‰
3. âœ… æ£€æŸ¥ Vercel Runtime Logsï¼ˆ10 åˆ†é’Ÿï¼‰
4. âœ… ç¡®å®šå…·ä½“åŸå› 

### çŸ­æœŸä¿®å¤ï¼ˆæœ¬å‘¨ï¼‰

æ ¹æ®è¯Šæ–­ç»“æœé€‰æ‹©ä¿®å¤æ–¹æ¡ˆï¼š

**å¦‚æœæ˜¯ ISR æœªç”Ÿæ•ˆ**ï¼š
- æ£€æŸ¥å¹¶ç§»é™¤åŠ¨æ€ API ä½¿ç”¨
- ç¡®ä¿ `revalidate` é…ç½®æ­£ç¡®
- æµ‹è¯• Edge Cache æ˜¯å¦ç”Ÿæ•ˆ

**å¦‚æœæ˜¯å¹¶å‘é‡å¤å†™å…¥**ï¼š
- å®æ–½ç¼“å­˜é”æœºåˆ¶
- æµ‹è¯•å¹¶å‘åœºæ™¯

**å¦‚æœæ˜¯ç¼“å­˜é”®è¿‡å¤š**ï¼š
- å®æ–½ Redis ä¼˜åŒ–æ–¹æ¡ˆï¼ˆ17 keys â†’ 1 keyï¼‰
- æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§

### é•¿æœŸä¼˜åŒ–ï¼ˆä¸‹å‘¨ï¼‰

1. å®æ–½å®Œæ•´çš„ Redis ä¼˜åŒ–æ–¹æ¡ˆ
2. æ·»åŠ ç›‘æ§å’Œå‘Šè­¦
3. ä¼˜åŒ–å…¶ä»–é«˜é¢‘é¡µé¢ï¼ˆå°è¯´è¯¦æƒ…ã€ç« èŠ‚é˜…è¯»ï¼‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

ä¿®å¤åï¼ŒéªŒè¯ä»¥ä¸‹æŒ‡æ ‡ï¼š

### æµ‹è¯• 1ï¼šé¦–é¡µåˆ·æ–°æµ‹è¯•

```bash
# æ¸…é™¤ Upstash Redis
npm run cache:clear

# è®°å½•åˆå§‹ commands æ•°
INITIAL=$(æŸ¥çœ‹ Upstash Dashboard)

# åˆ·æ–°é¦–é¡µ 10 æ¬¡
for i in {1..10}; do
  curl -s https://butternovel.com/ > /dev/null
  sleep 1
done

# è®°å½•æœ€ç»ˆ commands æ•°
FINAL=$(æŸ¥çœ‹ Upstash Dashboard)

# è®¡ç®—æ¶ˆè€—
CONSUMED=$((FINAL - INITIAL))

echo "Commands consumed: $CONSUMED"
```

**é¢„æœŸç»“æœ**ï¼š
- **ISR æ­£å¸¸** + **é¦–æ¬¡è®¿é—®**ï¼š34 commands (17 reads + 17 writes)
- **ISR æ­£å¸¸** + **åç»­è®¿é—®**ï¼š0 commands (Edge Cache å‘½ä¸­)
- **ISR æœªç”Ÿæ•ˆ** + **ä¼˜åŒ–å‰**ï¼š170 commands (17 reads Ã— 10)
- **ISR æœªç”Ÿæ•ˆ** + **ä¼˜åŒ–å**ï¼š10 commands (1 read Ã— 10)

---

### æµ‹è¯• 2ï¼šå¹¶å‘è®¿é—®æµ‹è¯•

```bash
# ä½¿ç”¨ Apache Bench æ¨¡æ‹Ÿå¹¶å‘
ab -n 100 -c 10 https://butternovel.com/

# æ£€æŸ¥ Upstash Commands å¢åŠ é‡
# åº”è¯¥æ¥è¿‘ 34ï¼Œè€Œä¸æ˜¯ 340ï¼ˆ10 å€ï¼‰
```

---

### æµ‹è¯• 3ï¼šä¸åŒé¡µé¢æµ‹è¯•

åˆ†åˆ«æµ‹è¯•ï¼š
- é¦–é¡µï¼š`/`
- å°è¯´è¯¦æƒ…ï¼š`/novels/[slug]`
- ç« èŠ‚é˜…è¯»ï¼š`/novels/[slug]/chapters/[number]`
- åˆ†ç±»é¡µï¼ˆå¦‚æœæœ‰ï¼‰

è®°å½•æ¯ä¸ªé¡µé¢çš„ commands æ¶ˆè€—ã€‚

---

##  æ€»ç»“

### å…³é”®è¯Šæ–­ç‚¹

1. **Vercel Cache Headers**ï¼šæ˜¯ HIT è¿˜æ˜¯ MISSï¼Ÿ
2. **Upstash Metrics**ï¼šreads vs writes æ¯”ä¾‹
3. **Vercel Logs**ï¼šç¼“å­˜å‘½ä¸­ç‡
4. **å¹¶å‘è¡Œä¸º**ï¼šæ˜¯å¦æœ‰é‡å¤å†™å…¥

### ä¼˜å…ˆçº§

1. **P0**ï¼šè¯Šæ–­å…·ä½“åŸå› ï¼ˆ1 å°æ—¶ï¼‰
2. **P1**ï¼šå®æ–½å¿«é€Ÿä¿®å¤ï¼ˆ2-4 å°æ—¶ï¼‰
3. **P2**ï¼šå®Œæ•´ Redis ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰
4. **P3**ï¼šç›‘æ§å’Œå‘Šè­¦ï¼ˆ1 å¤©ï¼‰

### é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œcommands æ¶ˆè€—åº”è¯¥ï¼š
- **æœ€ä½³æƒ…å†µ**ï¼ˆISR ç”Ÿæ•ˆï¼‰ï¼šé¦–æ¬¡ 34ï¼Œåç»­ 0
- **æ¬¡ä½³æƒ…å†µ**ï¼ˆISR æœªç”Ÿæ•ˆ + ä¼˜åŒ–ï¼‰ï¼šæ¯æ¬¡ 1-2 commands
- **å½“å‰æƒ…å†µ**ï¼ˆå¼‚å¸¸ï¼‰ï¼šæ¯æ¬¡ 40-50 commands

---

éœ€è¦æˆ‘å¸®ä½ æ‰§è¡Œå…·ä½“çš„è¯Šæ–­æ­¥éª¤å—ï¼Ÿè¯·å‘Šè¯‰æˆ‘ï¼š
1. ä½ åœ¨ Upstash Dashboard çœ‹åˆ°çš„å…·ä½“æ•°æ®
2. è®¿é—®é¦–é¡µæ—¶çš„å“åº”å¤´ï¼ˆx-vercel-cacheï¼‰
3. Vercel Runtime Logs ä¸­çš„å…³é”®ä¿¡æ¯

è¿™æ ·æˆ‘å¯ä»¥æä¾›æ›´ç²¾ç¡®çš„ä¿®å¤æ–¹æ¡ˆã€‚
